# TestTask

Проект представляет собой прототип мобильной 2D-игры, построенный вокруг модульной архитектуры, ориентированной на расширяемость, повторное использование компонентов и слабую связанность подсистем.
Основная цель - продемонстрировать подходы, применяемые при разработке реальных игровых систем: событийная модель, стейт-машины, пул объектов, работа со ScriptableObject, сохранения, инвентарь и AI.

Проект разбит на независимые модули, каждый из которых решает строго свою задачу. Архитектура позволяет легко добавлять новые виды врагов, предметов, оружия, UI-элементов и игровых механик без изменения существующего кода.


Архитектурные принципы

- Событийная архитектура (EventBus)

Все подсистемы взаимодействуют через собственную реализацию EventBus.
Такой подход полностью устраняет прямые зависимости между компонентами, делает систему гибкой, легко поддерживаемой и хорошо расширяемой.
UI, инвентарь, здоровье, стрельба и враги реагируют на события, не зная друг о друге напрямую.


- Пул объектов (Object Pool)

Пули, враги и предметы дропа создаются через ObjectPool.
Это снижает количество аллокаций, уменьшает нагрузку на GC, повышает FPS при массовом спавне объектов. Особенно важно для мобильных устройств.


- Стейт-машины

Игрок и враги используют чётко выделенные состояния (Idle, Run, Wander, Attack, Dead).
Каждое состояние инкапсулирует свою логику, что избавляет от громоздких "if/else" или "switch", упрощает сопровождение, позволяет легко добавлять новые поведения


- Модульность

Система разделена на независимые модули:
UI, здоровье, AI, оружие, инвентарь, сохранения — всё изолировано и взаимодействует через события.
Это уменьшает связанность и облегчает тестирование и повторное использование.


- Конфигурация через ScriptableObject

Все предметы инвентаря описаны через ScriptableObject, что позволяет настраивать параметры без изменения кода, легко балансировать характеристики, добавлять новые предметы в пару кликов.


- Система сохранений (SaveSystem, Singleton)

SaveSystem реализован как Singleton, доступный из любой части проекта.
Он отвечает за сохранение данных инвентаря в JSON, восстановление точного состояния слотов, инициализацию данных при первом запуске.
Singleton обеспечивает единое глобальное хранилище данных, удобный доступ без передачи зависимостей, гарантию, что в игре существует только один экземпляр SaveSystem.




Структура проекта:

Core

- EventBus:

Шина событий. Позволяет подписываться и отправлять события без прямых связей между объектами.
Используется UI, инвентарём, системой стрельбы, сохранением и врагами.

- ObjectPool:

Система пула объектов для повторного использования.
Используется для: пуль (BulletProjectile) и спавна врагов (Enemy)

- SaveSystem:

Сохранение/загрузка состояния игры в JSON.
Хранит: содержимое инвентаря (конкретные слоты и количество)
Реализован как Singleton.




Enemies

- Enemy:

Отдельная сущность врага: здоровье, передвижение, агрессия, дроп лута.
State-Machine (AI Navigation)
Внешний пакет с простой FSM из 4 состояний (Idle, Run, Attack, Wander)

- EnemySpawner:

Спавн врагов по рандомным точкам в указанной области.

- EnemyManager:

Контролирует всех врагов, обрабатывает логику спавна и смертей.

- DropOnDeath:

При смерти врага отправляет событие и создаёт предмет.




- Player:

Базовая логика передвижения, ввода и взаимодействий.
3 состояния PlayerAliveState / PlayerDeadState / PlayerDoNothingState
Инкапсуляция логики поведения по состояниям. Каждое состояние реализовано отдельным классом.
Например: DeadState полностью отключает управление, UI и стрельбу.




- Gun:

Подсистема стрельбы.

- GunHandler:

Отвечает за прицеливание, выстрел, расход боеприпасов и вызов событий стрельбы

- BulletProjectile:

Логика пули: полёт, столкновения, нанесение урона.




- Health:

Содержит количество HP, умеет получать урон, посылает HealthChangedEvent и DiedEvent.

- IDamageable:

Интерфейс для любого объекта, получающего урон.

- HealthUI:

Отображает текущее здоровье игрока (статус-бар).




- Inventory:

Хранит фиксированный массив слотов. Поддерживает: стаки предметов, проверку свободного места, добавление и удаление, сохранение слота при загрузке

- InventoryManager:

Контролирует основный функции инвентаря

- InventorySlotUI:

UI-представление отдельного слота.

- InventoryUI:

Обновляет визуальную часть инвентаря по событиям.

- InventoryDatabase:

База всех предметов игры.

- ItemSO:

ScriptableObject для предметов. Можно указывать (Id, DisplayName, Sprite, MaxStack)

- PickupItem:

Предметы, лежащие в мире и подбираемые игроком.




- MainLevel:

LevelManager.
Отвечает за: старт уровня, определение победы/поражения, респавн игрока, вызов событий уровня





- UIManager:

Связывает игровые события с отображением HUD: инвентарь, здоровье, количество патронов

- CameraShake:

Простой эффект тряски камеры (стрельба, попадания).

- ShootButton:

Кнопка стрельбы для мобильных устройств, отправляет ShootButtonPressEvent.
